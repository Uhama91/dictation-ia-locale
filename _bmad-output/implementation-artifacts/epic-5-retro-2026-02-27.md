# Epic 5 Retrospective : Onboarding, modèles et vie privée

**Date** : 2026-02-27
**Epic** : Epic 5 — Onboarding, modèles et vie privée
**Stories** : 5.1, 5.2, 5.3, 5.4
**Status** : DONE

---

## Summary

Epic 5 a comblé les gaps UX/i18n et fonctionnels identifiés par un audit de conformité des 15 ACs. L'approche a été : audit AC → matrice de conformité (4 PASS, 3 PARTIAL, 8 FAIL) → plan de 9 changements → implémentation en un pass → code review adversarial → 3 corrections. Le fork Handy fournissait déjà l'infrastructure (onboarding, permissions macOS, modèle download), l'Epic 5 a ajouté : dé-jargon des noms de modèles, bouton Réessayer, détection Ollama, banner conditionnel, event fallback LLM, état permission denied, écran QuickTest, PrivacyBadge, renommage Handy → DictAI dans 17 locales.

---

## Metrics

| Metric | Value |
|--------|-------|
| Stories completed | 4/4 (100%) |
| Files modified | 29 (3 nouveaux, 26 modifiés) |
| Lines | +665 / -226 |
| Tests added | 0 |
| Tests existing | 137/137 pass (0 regression) |
| TypeScript errors | 0 |
| Code reviews | 1 adversarial → 3 findings, tous corrigés |
| Commits | 1 (monolithique) |
| FRs covered | FR27, FR28, FR29, FR33, FR34, FR35 (6/6) |

---

## Story Results

### Story 5.1 — Détection et téléchargement modèle Whisper

- **Status** : DONE
- **ACs** : 4/4 PASS
- **Key work** : Dé-jargon noms modèles dans 17 locales (Whisper Small → Modèle rapide, etc.), bouton Réessayer inline sur ModelCard en état error

### Story 5.2 — Détection Ollama et fallback rules-only

- **Status** : DONE
- **ACs** : 4/4 PASS
- **Key work** : Commande Tauri `check_ollama_status` (specta), OllamaBanner conditionnel (post_process_enabled + localStorage dismiss), event `llm-fallback` émis depuis orchestrator.rs → toast frontend

### Story 5.3 — Onboarding permissions macOS

- **Status** : DONE
- **ACs** : 4/4 PASS
- **Key work** : Message privacy ("audio traité localement"), état "denied" avec bouton "Ouvrir Préférences Système" (openUrl plugin-opener), QuickTest onboarding screen, bypass "Continuer sans permissions" pour returning users

### Story 5.4 — Indicateur vie privée

- **Status** : DONE
- **ACs** : 3/3 PASS
- **Key work** : PrivacyBadge (vert "Local" / orange "Téléchargement") dans le footer, écoute events model-download-progress/complete/cancelled

---

## What Went Well

1. **Approche audit AC → plan → code** — la matrice de conformité (15 ACs, diagnostic précis des gaps) a permis de cibler exactement les changements nécessaires
2. **Code review adversarial** — a détecté 3 vrais problèmes avant le push : Handy dans 15 locales, lockout permissions returning users, banner Ollama inconditionnel
3. **Réutilisation infrastructure Handy** — l'onboarding, les permissions macOS, le système de modèles existaient déjà, on a comblé des gaps UX plutôt que tout reconstruire
4. **Zéro régression** — 137 tests Rust passent, TypeScript compile proprement, pas de casse

## What Went Wrong

1. **Zéro tests ajoutés** — 3 nouveaux composants React (QuickTest, OllamaBanner, PrivacyBadge) sans aucun test, plus des modifications sur AccessibilityOnboarding et ModelCard non testées
2. **Pas de story files BMAD** — engagement reporté d'Epic 4, toujours pas respecté
3. **Commit monolithique** — 4 stories en 1 commit, impossible de revert une story isolément
4. **Engagement Epic 4 non tenu** — "Créer les story files BMAD avant implémentation" → non fait

---

## Key Learnings

### L1 — Le code review adversarial est devenu un filet de sécurité structurel
Sans le review, 3 problèmes réels seraient passés en production. Ce n'est pas un luxe, c'est un prérequis.

### L2 — La dette de tests frontend est maintenant critique
5 epics sans tests React. La refonte visuelle Epic 6 va toucher quasiment tous les composants — le risque de régression silencieuse est élevé.

### L3 — Les engagements de rétro nécessitent un mécanisme d'enforcement
Les story files BMAD ont été engagés en rétro Epic 4 et non respectés. Un engagement sans accountability ne tient pas.

### L4 — L'approche "audit de conformité" est reproductible
Partir d'une matrice AC avec diagnostic (PASS/PARTIAL/FAIL) puis cibler les gaps est une approche efficace et reproductible pour les epics de stabilisation.

---

## Technical Debt

| ID | Description | Severity | Status |
|----|-------------|----------|--------|
| TD-E5-1 | Pas de tests pour QuickTest, OllamaBanner, PrivacyBadge | MEDIUM | SPRINT DÉDIÉ |
| TD-E5-2 | Pas de test Rust pour check_ollama_status | LOW | ACCEPTED |
| TD-E4-3 | Pas de framework de test React (Vitest + RTL) | MEDIUM | SPRINT DÉDIÉ |
| TD-E5-3 | Pas de story files BMAD pour Epic 5 | LOW | ACCEPTED |
| TD-E5-4 | Commit monolithique (4 stories en 1 commit) | LOW | ACCEPTED — process à améliorer |

---

## Previous Retro Follow-Through (Epic 4)

| Engagement Epic 4 | Status |
|---|---|
| Créer les story files BMAD avant implémentation | ❌ Non fait |
| Ne pas sauter les retros | ✅ Fait (cette rétro) |
| Vérifier tous les ACs avant "done" | ⏳ Partiel — code review a rattrapé 3 gaps |

---

## Action Items

### Process
1. **1 commit = 1 story** — Owner: Dev — Critère: chaque story a son propre commit
2. **Créer les story files BMAD** (engagement reporté) — Owner: Scrum Master — Dès Epic 6
3. **Code review cross-LLM (Gemini) à chaque étape** — Owner: Ullie — Appliqué depuis Epic 4

### Sprint Stabilisation (avant Epic 6)
1. **Mise en place Vitest + React Testing Library** — Framework de test frontend
2. **Tests composants Epic 4** — HistorySettings, DictationDetails
3. **Tests composants Epic 5** — QuickTest, OllamaBanner, PrivacyBadge, AccessibilityOnboarding (denied state), ModelCard (error state)
4. **Code review Gemini à chaque étape du sprint**

### Résolus en session
- ✅ Handy → DictAI dans les 17 locales
- ✅ Graceful degradation permissions (returning users)
- ✅ OllamaBanner conditionnel sur post_process_enabled

---

## Next Epic Preview

**Epic 6 : Identité visuelle DictAI** (3 stories)
- 6.1 : Thème "cahier de classe" et design tokens
- 6.2 : Navigation simplifiée 3 sections
- 6.3 : Page À propos

Dépendances sur Epic 5 : minimales (renommage Handy → DictAI déjà fait).
Prérequis : sprint stabilisation tests frontend.

---

## Artifacts

| Artifact | Path |
|----------|------|
| Sprint Status | `_bmad-output/implementation-artifacts/sprint-status.yaml` |
| Epic 5 commit | `7f8105c` |
| Previous retro (Epic 4) | `_bmad-output/implementation-artifacts/epic-4-retro-2026-02-27.md` |
| This Retrospective | `_bmad-output/implementation-artifacts/epic-5-retro-2026-02-27.md` |
